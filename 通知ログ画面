import React, { useEffect, useState } from 'react';
import { getFirestore, collection, query, orderBy, limit, getDocs } from 'firebase/firestore';
import { initializeApp } from 'firebase/app';

// FirebaseåˆæœŸè¨­å®šï¼ˆè‡ªåˆ†ã®è¨­å®šã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
const firebaseConfig = {
  apiKey: 'YOUR_API_KEY',
  authDomain: 'YOUR_AUTH_DOMAIN',
  projectId: 'YOUR_PROJECT_ID',
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// é€šçŸ¥ãƒ­ã‚°ã®å‹å®šç¾©
type NotificationLog = {
  id: string;           // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID
  timestamp: Date;      // é€šçŸ¥æ—¥æ™‚
  character: string;    // é€šçŸ¥ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åï¼ˆä¾‹ï¼šç—…ã¿å½¼å¥³ã€ä½“è‚²ä¼šç³»å…ˆè¼©ãªã©ï¼‰
  message: string;      // é€šçŸ¥å†…å®¹ã®ãƒ†ã‚­ã‚¹ãƒˆ
};

const NotificationLogScreen: React.FC = () => {
  const [logs, setLogs] = useState<NotificationLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchLogs = async () => {
      setLoading(true);
      try {
        // é€šçŸ¥ãƒ­ã‚°ã‚’æ—¥æ™‚é™é †ã§æœ€å¤§100ä»¶å–å¾—
        const q = query(collection(db, 'notificationLogs'), orderBy('timestamp', 'desc'), limit(100));
        const querySnapshot = await getDocs(q);

        const data: NotificationLog[] = [];
        querySnapshot.forEach(doc => {
          const d = doc.data();
          data.push({
            id: doc.id,
            timestamp: d.timestamp.toDate ? d.timestamp.toDate() : new Date(d.timestamp),
            character: d.character,
            message: d.message,
          });
        });

        setLogs(data);
      } catch (error) {
        console.error('é€šçŸ¥ãƒ­ã‚°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      } finally {
        setLoading(false);
      }
    };
    fetchLogs();
  }, []);

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <div style={{ maxWidth: 700, margin: 'auto', padding: 20 }}>
      <h1>ğŸ•‘ é€šçŸ¥ãƒ­ã‚°</h1>
      {logs.length === 0 && <p>é€šçŸ¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>}

      {/* é€šçŸ¥ãƒ­ã‚°ä¸€è¦§ */}
      <ul style={{ listStyle: 'none', padding: 0 }}>
        {logs.map(log => (
          <li key={log.id} style={{ marginBottom: 15, borderBottom: '1px solid #ccc', paddingBottom: 10 }}>
            <div><strong>æ—¥æ™‚:</strong> {log.timestamp.toLocaleString()}</div>
            <div><strong>é€šçŸ¥ã‚­ãƒ£ãƒ©:</strong> {log.character}</div>
            <div><strong>å†…å®¹:</strong> {log.message}</div>
          </li>
        ))}
      </ul>
    </div>
  );
};

export default NotificationLogScreen;
